<section id="track-changes-replicate" class="resource-group"><h2 class="group-heading">Track Changes / Replicate <a href="#track-changes-replicate" class="permalink">&para;</a></h2><h3 id="header-how-it-works">How it works <a class="permalink" href="#header-how-it-works" aria-hidden="true">¶</a></h3>
<p>Every change in the webling dataset creates a new revision with a revision ID (increases with every change).
The data you see in the webling frontend is at the latest revision.
If you want to synchronize your dataset with the latest changes from Webling, you can use the /replicate or the /changes endpoint.
Both endpoints have the same return format.</p>
<h3 id="header-get-changes-by-time-(-changes)">Get changes by time (/changes) <a class="permalink" href="#header-get-changes-by-time-(-changes)" aria-hidden="true">¶</a></h3>
<p>The easiest way to get changes ist to call the <code>/changes/{timestamp}</code> endpoint.
It will return all changes that happened since {timestamp}. The result contains the IDs of the objects with changes.
This is especially useful for things that run at a specific interval (e.g. cronjobs).</p>
<h3 id="header-get-changes-by-revision-(-replicate)">Get changes by revision (/replicate) <a class="permalink" href="#header-get-changes-by-revision-(-replicate)" aria-hidden="true">¶</a></h3>
<p>The other option is calling the <code>/replicate/{revision}</code> endpoint. It will return all changes that happened since a specific revision.
This is especially useful when you are not syncing in a regular interval.</p>
<p>When you start syncing, you need to save the revision ID from the current sync.
When you start the next sync cycle, first check if the revision has changed.
To do that, you call <code>/replicate/{revision-id-on-last-sync}</code> and you’ll get the latest revision ID and all object IDs that have changed (if any).
You only need to fetch the objects that changed.</p>
<h4 id="header-example">Example <a class="permalink" href="#header-example" aria-hidden="true">¶</a></h4>
<p>Let’s say the current revision is 100:</p>
<p>Calling <code>/replicate/97</code> returns all changes in revision 98, 99 and 100.</p>
<p>Calling <code>/replicate/98</code> returns all changes in revision 99 and 100.</p>
<p>Calling <code>/replicate/99</code> returns all changes in revision 100.</p>
<p>Calling <code>/replicate/100</code> returns no changes, since it is the current revision</p>
<p>You would usually call the replicate command with the last known revision (e.g. <code>/replicate/100</code>).
As soon as there is a new revision, and you call <code>/replicate/100</code>, you’ll get the changes and the latest revision in the API response.
Now save the new revision as the “latest known revision” for further API calls (next call may be <code>/replicate/102</code>).</p>
<p>If you make any changes to the permissions of the API-Key, the endpoint will return <code>-1</code> when calling <code>/replicate/&lt;revision_id&gt;</code>.
You need to clean your cache (if you have any - and you should) and start syncing again, because you may now see different data than before.</p>
<div id="track-changes-replicate-get-changes-since-timestamp" class="resource"><h3 class="resource-heading">Get Changes since Timestamp <a href="#track-changes-replicate-get-changes-since-timestamp" class="permalink">&nbsp;&para;</a></h3><div id="track-changes-replicate-get-changes-since-timestamp-get" class="action get"><h4 class="action-heading"><div class="name">Get Changes</div><a href="#track-changes-replicate-get-changes-since-timestamp-get" class="method get">GET</a><code class="uri">/changes/{timestamp}</code></h4><p>Get all changed objects since the passed timestamp.</p>
<p><code>objects</code> contains all changed object IDs, grouped by type.</p>
<p><code>deleted</code> contains all deleted object IDs. All IDs in deleted are also contained in objects.</p>
<p><code>context</code> reserved for future use</p>
<p><code>definitions</code> if the definition of datatypes has changed, the types will be listed here</p>
<p><code>quota</code> is set to tue if /quota data has changed</p>
<p><code>subscription</code> is set to true if /subscription data has changed</p>
<p><code>revision</code> Latest revision.</p>
<p><code>version</code> Current Webling version.</p>
<h4>Example URI</h4><div class="definition"><span class="method get">GET</span>&nbsp;<span class="uri"><span class="hostname"></span>/changes/<span class="hljs-attribute" title="timestamp">1631167410</span></span></div><div class="title"><strong>URI Parameters</strong><div class="collapse-button show"><span class="close">Hide</span><span class="open">Show</span></div></div><div class="collapse-content"><dl class="inner"><dt>timestamp</dt><dd><code>number</code>&nbsp;<span class="required">(required)</span>&nbsp;<span class="text-muted example"><strong>Example:&nbsp;</strong><span>1631167410</span></span><p>Unix timestamp since when you want to synchronize</p>
</dd></dl></div><div class="title"><strong>Response&nbsp;&nbsp;<code>200</code></strong><div class="collapse-button"><span class="close">Hide</span><span class="open">Show</span></div></div><div class="collapse-content"><div class="inner"><h5>Headers</h5><pre><code><span class="hljs-attribute">Content-Type</span>: <span class="hljs-string">application/json</span></code></pre><div style="height: 1px;"></div><h5>Body</h5><pre><code>{
  "<span class="hljs-attribute">objects</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">member</span>": <span class="hljs-value">[
      <span class="hljs-number">469</span>,
      <span class="hljs-number">492</span>
    ]</span>,
    "<span class="hljs-attribute">membergroup</span>": <span class="hljs-value">[
      <span class="hljs-number">554</span>,
      <span class="hljs-number">552</span>
    ]</span>,
    "<span class="hljs-attribute">debitor</span>": <span class="hljs-value">[
      <span class="hljs-number">848</span>
    ]
  </span>}</span>,
  "<span class="hljs-attribute">deleted</span>": <span class="hljs-value">[
    <span class="hljs-number">492</span>
  ]</span>,
  "<span class="hljs-attribute">context</span>": <span class="hljs-value">[]</span>,
  "<span class="hljs-attribute">definitions</span>": <span class="hljs-value">[]</span>,
  "<span class="hljs-attribute">quota</span>": <span class="hljs-value"><span class="hljs-literal">true</span></span>,
  "<span class="hljs-attribute">subscription</span>": <span class="hljs-value"><span class="hljs-literal">false</span></span>,
  "<span class="hljs-attribute">revision</span>": <span class="hljs-value"><span class="hljs-number">1530</span></span>,
  "<span class="hljs-attribute">version</span>": <span class="hljs-value"><span class="hljs-number">720</span>
</span>}</code></pre><div style="height: 1px;"></div></div></div></div></div><div id="track-changes-replicate-current-revision" class="resource"><h3 class="resource-heading">Current Revision <a href="#track-changes-replicate-current-revision" class="permalink">&nbsp;&para;</a></h3><div id="track-changes-replicate-current-revision-get" class="action get"><h4 class="action-heading"><div class="name">Current Revision</div><a href="#track-changes-replicate-current-revision-get" class="method get">GET</a><code class="uri">/replicate</code></h4><p><code>revision</code> Latest revision.</p>
<p><code>version</code> Current Webling version.</p>
<h4>Example URI</h4><div class="definition"><span class="method get">GET</span>&nbsp;<span class="uri"><span class="hostname"></span>/replicate</span></div><div class="title"><strong>Response&nbsp;&nbsp;<code>200</code></strong><div class="collapse-button"><span class="close">Hide</span><span class="open">Show</span></div></div><div class="collapse-content"><div class="inner"><h5>Headers</h5><pre><code><span class="hljs-attribute">Content-Type</span>: <span class="hljs-string">application/json</span></code></pre><div style="height: 1px;"></div><h5>Body</h5><pre><code>{
  "<span class="hljs-attribute">revision</span>": <span class="hljs-value"><span class="hljs-number">1530</span></span>,
  "<span class="hljs-attribute">version</span>": <span class="hljs-value"><span class="hljs-number">720</span>
</span>}</code></pre><div style="height: 1px;"></div></div></div></div></div><div id="track-changes-replicate-get-changes-after-a-revision" class="resource"><h3 class="resource-heading">Get Changes after a Revision <a href="#track-changes-replicate-get-changes-after-a-revision" class="permalink">&nbsp;&para;</a></h3><div id="track-changes-replicate-get-changes-after-a-revision-get" class="action get"><h4 class="action-heading"><div class="name">Get Changes</div><a href="#track-changes-replicate-get-changes-after-a-revision-get" class="method get">GET</a><code class="uri">/replicate/{id}</code></h4><p>Get all changed objects since a specific revision compared to the latest revision.</p>
<p><code>objects</code> contains all changed object IDs, grouped by type.</p>
<p><code>deleted</code> contains all deleted object IDs. All IDs in deleted are also contained in objects.</p>
<p><code>context</code> reserved for future use</p>
<p><code>definitions</code> if the definition of datatypes has changed, the types will be listed here</p>
<p><code>quota</code> is set to tue if /quota data has changed</p>
<p><code>subscription</code> is set to true if /subscription data has changed</p>
<p><code>revision</code> Latest revision.</p>
<p><code>version</code> Current Webling version.</p>
<h4>Example URI</h4><div class="definition"><span class="method get">GET</span>&nbsp;<span class="uri"><span class="hostname"></span>/replicate/<span class="hljs-attribute" title="id">1529</span></span></div><div class="title"><strong>URI Parameters</strong><div class="collapse-button show"><span class="close">Hide</span><span class="open">Show</span></div></div><div class="collapse-content"><dl class="inner"><dt>id</dt><dd><code>number</code>&nbsp;<span class="required">(required)</span>&nbsp;<span class="text-muted example"><strong>Example:&nbsp;</strong><span>1529</span></span><p>Revision ID</p>
</dd></dl></div><div class="title"><strong>Response&nbsp;&nbsp;<code>200</code></strong><div class="collapse-button"><span class="close">Hide</span><span class="open">Show</span></div></div><div class="collapse-content"><div class="inner"><h5>Headers</h5><pre><code><span class="hljs-attribute">Content-Type</span>: <span class="hljs-string">application/json</span></code></pre><div style="height: 1px;"></div><h5>Body</h5><pre><code>{
  "<span class="hljs-attribute">objects</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">member</span>": <span class="hljs-value">[
      <span class="hljs-number">469</span>,
      <span class="hljs-number">492</span>
    ]</span>,
    "<span class="hljs-attribute">membergroup</span>": <span class="hljs-value">[
      <span class="hljs-number">554</span>,
      <span class="hljs-number">552</span>
    ]</span>,
    "<span class="hljs-attribute">debitor</span>": <span class="hljs-value">[
      <span class="hljs-number">848</span>
    ]
  </span>}</span>,
  "<span class="hljs-attribute">deleted</span>": <span class="hljs-value">[
    <span class="hljs-number">492</span>
  ]</span>,
  "<span class="hljs-attribute">context</span>": <span class="hljs-value">[]</span>,
  "<span class="hljs-attribute">definitions</span>": <span class="hljs-value">[]</span>,
  "<span class="hljs-attribute">quota</span>": <span class="hljs-value"><span class="hljs-literal">true</span></span>,
  "<span class="hljs-attribute">subscription</span>": <span class="hljs-value"><span class="hljs-literal">false</span></span>,
  "<span class="hljs-attribute">revision</span>": <span class="hljs-value"><span class="hljs-number">1530</span></span>,
  "<span class="hljs-attribute">version</span>": <span class="hljs-value"><span class="hljs-number">720</span>
</span>}</code></pre><div style="height: 1px;"></div></div></div></div></div></section>